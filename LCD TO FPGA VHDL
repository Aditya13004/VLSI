--	Company:	--	Engineer:	--	--	Create	Date:				11:38:43	11/06/2025	--	Design	Name:				LCD	FSM	Controller
--	Design	Name:				LCD	FSM	Controller--	Module	Name:				LCD_FSM	-	Behavioral	--	Description:				Finite	State	Machine	for	LCD	initialization	and	data	display----------------------------------------------------------------------------------
 library	IEEE;
 use	IEEE.STD_LOGIC_1164.ALL;
 use	IEEE.STD_LOGIC_ARITH.ALL;
 use	IEEE.STD_LOGIC_UNSIGNED.ALL;
 entity	LCD_FSM	is
				Port	(
								rst							:	in		STD_LOGIC;																						--	reset
								clk_12Mhz	:	in		STD_LOGIC;																						--	high	frequency	clock
								lcd_rs				:	out	STD_LOGIC;																						--	LCD	RS	control
								lcd_en				:	out	STD_LOGIC;																						--	LCD	Enable
								lcd_data		:	out	STD_LOGIC_VECTOR(7	downto	0)				--	LCD	Data	port
				);
 end	LCD_FSM;
 architecture	Behavioral	of	LCD_FSM	is
				--	internal	signals
				signal	div							:	STD_LOGIC_VECTOR(15	downto	0)	:=	(others	=>	'0');
				signal	clk_fsm			:	STD_LOGIC;
				signal	lcd_rs_s		:	STD_LOGIC;
				signal	dataout_s	:	STD_LOGIC_VECTOR(7	downto	0);
				--	FSM	states
				type	state_type	is	(s_reset,	func,	mode,	cur,	clear,	d0,	d1,	d2,	d3,	d4,	hold);
				signal	ps1,	nx	:	state_type;
 begin
				----------------------------------------------------------------------------
				--	Clock	Divider	:	Generate	slow	clock	for	LCD	FSM
				----------------------------------------------------------------------------
				clk_divider	:	process(rst,	clk_12Mhz)
				begin
								if	(rst	=	'1')	then
												div	<=	(others	=>	'0');
								elsif	rising_edge(clk_12Mhz)	then
												div	<=	div	+	1;
								end	if;
				end	process;
				clk_fsm	<=	div(15);		--	slow	clock	for	FSM
				----------------------------------------------------------------------------
				--	Present	State	Register
				----------------------------------------------------------------------------
				process(rst,	clk_fsm)
				begin
								if	(rst	=	'1')	then
												ps1	<=	s_reset;
								elsif	rising_edge(clk_fsm)	then
												ps1	<=	nx;
								end	if;
				end	process;
				----------------------------------------------------------------------------
				--	Next	State	and	Output	Logic
				----------------------------------------------------------------------------
				process(ps1)
				begin
								case	ps1	is
												--------------------------------------------------------------------
												when	s_reset	=>
																nx								<=	func;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00111000";			--	38h:	Function	set
												--------------------------------------------------------------------
												when	func	=>
																nx								<=	mode;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00111000";			--	38h:	8-bit,	2-line,	5x7	dots
												--------------------------------------------------------------------
												when	mode	=>
																nx								<=	cur;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00000110";			--	06h:	Entry	mode	set
												--------------------------------------------------------------------
												when	cur	=>
																nx								<=	clear;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00001100";			--	0Ch:	Display	ON,	Cursor	OFF
												--------------------------------------------------------------------
												when	clear	=>
																nx								<=	d0;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00000001";			--	01h:	Clear	display
												--------------------------------------------------------------------
												--------------------------------------------------------------------
												when	d0	=>
																nx								<=	d1;
																lcd_rs_s		<=	'1';
																dataout_s	<=	"01010000";			--	'P'
												--------------------------------------------------------------------
												when	d1	=>
																nx								<=	d2;
																lcd_rs_s		<=	'1';
																dataout_s	<=	"01001001";			--	'I'
												--------------------------------------------------------------------
												when	d2	=>
																nx								<=	d3;
																lcd_rs_s		<=	'1';
																dataout_s	<=	"01000011";			--	'C'
												--------------------------------------------------------------------
												when	d3	=>
																nx								<=	d4;
																lcd_rs_s		<=	'1';
																dataout_s	<=	"01010100";			--	'T'
												--------------------------------------------------------------------
												when	d4	=>
																nx								<=	hold;
																lcd_rs_s		<=	'1';
																dataout_s	<=	"00100000";			--	'	'	(space)
												--------------------------------------------------------------------
												when	hold	=>
																nx								<=	hold;
																lcd_rs_s		<=	'0';
																dataout_s	<=	"00000000";			--	hold
												--------------------------------------------------------------------
												when	others	=>
																nx								<=	s_reset;
																lcd_rs_s		<=	'0';
																dataout_s	<=	(others	=>	'0');
								end	case;
				end	process;
				----------------------------------------------------------------------------
				--	Output	assignments
				----------------------------------------------------------------------------
				lcd_en			<=	clk_fsm;
				lcd_rs			<=	lcd_rs_s;
				lcd_data	<=	dataout_s;
 end	Behavioral;
